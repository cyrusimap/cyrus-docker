#!/usr/bin/perl
use v5.36.0;
use Process::Status;

my $root = "/srv/cyrus-imapd";
chdir $root or die "can't chdir to $root: $!";

system('git clean -dfx');
Process::Status->assert_ok("git clean");

$ENV{CFLAGS}="-g -W -Wall -Wextra -Werror";

my @configopts = qw(
  --enable-autocreate
  --enable-backup
  --enable-calalarmd
  --enable-gssapi
  --enable-http
  --enable-idled
  --enable-murder
  --enable-nntp
  --enable-replication
  --enable-shared
  --enable-silent-rules
  --enable-unit-tests
  --enable-xapian
  --enable-jmap
  --with-ldap=/usr"
);

local $ENV{CONFIGOPTS} = "@configopts";

system('./tools/build-with-cyruslibs.sh');
Process::Status->assert_ok("building cyrus-imapd");
